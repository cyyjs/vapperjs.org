<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data prefetch | Vapper</title>
    <meta name="description" content="A Vue-based server-side rendering framework">
    
    
    <link rel="preload" href="/assets/css/0.styles.02f63e62.css" as="style"><link rel="preload" href="/assets/js/app.b7192d51.js" as="script"><link rel="preload" href="/assets/js/2.0aa0d321.js" as="script"><link rel="preload" href="/assets/js/15.d774fccf.js" as="script"><link rel="prefetch" href="/assets/js/10.c5aa1ba9.js"><link rel="prefetch" href="/assets/js/11.59d440b2.js"><link rel="prefetch" href="/assets/js/12.8b6fa802.js"><link rel="prefetch" href="/assets/js/13.cd21edf4.js"><link rel="prefetch" href="/assets/js/14.21e7def8.js"><link rel="prefetch" href="/assets/js/16.a175ac36.js"><link rel="prefetch" href="/assets/js/17.0cac33b8.js"><link rel="prefetch" href="/assets/js/18.d7d5205c.js"><link rel="prefetch" href="/assets/js/19.2a4846dd.js"><link rel="prefetch" href="/assets/js/20.2bfca4e4.js"><link rel="prefetch" href="/assets/js/21.d53e9b37.js"><link rel="prefetch" href="/assets/js/22.510b6ebc.js"><link rel="prefetch" href="/assets/js/23.e65b61ca.js"><link rel="prefetch" href="/assets/js/24.ea8b2c0c.js"><link rel="prefetch" href="/assets/js/25.22a2382e.js"><link rel="prefetch" href="/assets/js/26.bc263817.js"><link rel="prefetch" href="/assets/js/27.b6a010f2.js"><link rel="prefetch" href="/assets/js/28.532940af.js"><link rel="prefetch" href="/assets/js/29.14d06c89.js"><link rel="prefetch" href="/assets/js/3.c125d4a1.js"><link rel="prefetch" href="/assets/js/30.193b61d5.js"><link rel="prefetch" href="/assets/js/31.c6ddd288.js"><link rel="prefetch" href="/assets/js/32.47cc7273.js"><link rel="prefetch" href="/assets/js/33.62aa891b.js"><link rel="prefetch" href="/assets/js/34.6327eb07.js"><link rel="prefetch" href="/assets/js/35.5a845d23.js"><link rel="prefetch" href="/assets/js/36.3a4bcb18.js"><link rel="prefetch" href="/assets/js/37.e7b0f006.js"><link rel="prefetch" href="/assets/js/4.e3eeebf1.js"><link rel="prefetch" href="/assets/js/5.005534c8.js"><link rel="prefetch" href="/assets/js/6.47a15f4c.js"><link rel="prefetch" href="/assets/js/7.026f459a.js"><link rel="prefetch" href="/assets/js/8.81e69c3f.js"><link rel="prefetch" href="/assets/js/9.474bbc33.js">
    <link rel="stylesheet" href="/assets/css/0.styles.02f63e62.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vapper</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/introduction.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/write-plugin.html" class="nav-link">Advanced</a></div><div class="nav-item"><a href="/config.html" class="nav-link">Configuration</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/data-prefetching.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/data-prefetching.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/vapperjs/vapperjs.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduction.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/write-plugin.html" class="nav-link">Advanced</a></div><div class="nav-item"><a href="/config.html" class="nav-link">Configuration</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/data-prefetching.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/data-prefetching.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/vapperjs/vapperjs.org" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/usage.html" class="sidebar-link">Usage</a></li><li><a href="/entry.html" class="sidebar-link">Entry file</a></li><li><a href="/data-prefetching.html" class="active sidebar-link">Data prefetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-prefetching.html#the-createfetcher-function" class="sidebar-link">The $createFetcher function</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#avoid-duplicate-data-prefetching" class="sidebar-link">Avoid duplicate data prefetching</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#store-vuex" class="sidebar-link">Store(Vuex)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-prefetching.html#return-a-store-instance-in-the-entry-file" class="sidebar-link">Return a Store instance in the entry file</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#action-returns-a-promise-instance" class="sidebar-link">Action returns a Promise instance</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#mapactions-function" class="sidebar-link">mapActions function</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#call-createfetcher-in-actions" class="sidebar-link">Call $createFetcher in Actions</a></li></ul></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#use-apollo" class="sidebar-link">Use Apollo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-prefetching.html#manually-install-dependencies" class="sidebar-link">Manually install dependencies</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#createapolloclient" class="sidebar-link">createApolloClient</a></li><li class="sidebar-sub-header"><a href="/data-prefetching.html#return-apolloprovider-in-the-entry-file" class="sidebar-link">Return apolloProvider in the entry file</a></li></ul></li></ul></li><li><a href="/routes-meta.html" class="sidebar-link">Routes Meta</a></li><li><a href="/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/management-head.html" class="sidebar-link">Management &lt;head&gt;</a></li><li><a href="/assets.html" class="sidebar-link">Static Resource</a></li><li><a href="/caching.html" class="sidebar-link">Caching</a></li><li><a href="/using-plugin.html" class="sidebar-link">Using Plugin</a></li><li><a href="/injection.html" class="sidebar-link">Vapper Injection</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/config.html" class="sidebar-link">Configuration</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="data-prefetch"><a href="#data-prefetch" aria-hidden="true" class="header-anchor">#</a> Data prefetch</h1> <p><code>Vapper</code> provides more intuitive and powerful data prefetching capabilities, allowing you to perform data prefetching just like the <code>SPA</code> application.</p> <h2 id="the-createfetcher-function"><a href="#the-createfetcher-function" aria-hidden="true" class="header-anchor">#</a> The $createFetcher function</h2> <p>When developing <code>SPA</code> applications, we usually fetch data in the component's <code>created</code> or <code>mounted</code> hooks, for example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Created hook</span>
<span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Suppose the return value of the `fetchApi` function is a `Promise` instance.</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchApi</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>But this code can't run properly in the <code>SSR</code> application, because during the server rendering process, the application can't know when the request ends, and it can't know which data needs to be serialized and sent to the client. So in order for the above code to run in the <code>SSR</code> application, you can pass the <code>fetchApi</code> function as a parameter to the <code>$createFetcher</code> function, which is injected into the component instance by <code>Vapper</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Created hook</span>
<span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Call the this.$createFetcher function whose argument is a function that returns a Promise instance</span>
  <span class="token keyword">const</span> fetchList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$createFetcher</span><span class="token punctuation">(</span>fetchApi<span class="token punctuation">)</span>
  <span class="token comment">// Fetch data</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchList</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The above code is all the code for prefetching data in the <code>Vapper</code> application. Is it very simple?</p> <div class="tip custom-block"><p>Please note: Since the component's <code>mounted</code> hook function will not be executed during server-side rendering, you can only perform data prefetching in the <code>created</code> hook.</p></div> <h2 id="avoid-duplicate-data-prefetching"><a href="#avoid-duplicate-data-prefetching" aria-hidden="true" class="header-anchor">#</a> Avoid duplicate data prefetching</h2> <p>Reading the code above, you may have questions: &quot;Is the code inside the <code>created</code> hook function not executed on the server and client respectively? Does this lead to duplicate data prefetching?&quot;, in fact, no, <code>Vapper</code> automatically helps you avoid duplicate data prefetching, so you don't have to do anything.</p> <h2 id="store-vuex"><a href="#store-vuex" aria-hidden="true" class="header-anchor">#</a> Store(Vuex)</h2> <h3 id="return-a-store-instance-in-the-entry-file"><a href="#return-a-store-instance-in-the-entry-file" aria-hidden="true" class="header-anchor">#</a> Return a Store instance in the entry file</h3> <p><code>Vapper</code> allows you to optionally use <code>Vuex</code>, which is the same as creating an application instance, we also need to create a new <code>Stroe</code> instance for each request. Usually we will wrap the <code>createStore</code> factory function:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store/index.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">'./fetch'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createStore</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Return the Store instance</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    actions<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then create and return a <code>store</code> instance in the entry file:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">// src/main.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createApp</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// Create store instance</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>

  <span class="token comment">// return</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="action-returns-a-promise-instance"><a href="#action-returns-a-promise-instance" aria-hidden="true" class="header-anchor">#</a> Action returns a Promise instance</h3> <p>We know that the argument passed to the <code>this.$createFetcher</code> function is a function that returns a <code>Promise</code> instance. Therefore, if the return value of a <code>action</code> is a <code>Promise</code> instance, we can perform data prefetching like this:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// created hook</span>
<span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create a fetcher</span>
  <span class="token keyword">const</span> fetchList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$createFetcher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'fetchData'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// Call the fetchList function to fetch data</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchList</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If we use <code>async/await</code>, the code for <code>action</code> looks like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Send an asynchronous request</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setData'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mapactions-function"><a href="#mapactions-function" aria-hidden="true" class="header-anchor">#</a> mapActions function</h3> <p>If you use the <code>mapActions</code> function to map <code>actions</code> to the component's <code>methods</code>, the code will look more intuitive:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'fetchData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pass this.fetchData as a parameter to `this.$createFetcher`</span>
    <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$createFetcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fetchData<span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="call-createfetcher-in-actions"><a href="#call-createfetcher-in-actions" aria-hidden="true" class="header-anchor">#</a> Call $createFetcher in Actions</h3> <p>In the previous example, we all called the <code>this.$createFetcher</code> function in the <code>created</code> hook of the component to create <code>Fetcher</code>. If an <code>action</code> is used by multiple components, then calling the <code>this.$createFetcher</code> function in each component's <code>created</code> hook will be very cumbersome, therefore, we can move the call to the <code>this.$createFetcher</code> function to <code>action</code>:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> vm <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Call the $createFetcher function here</span>
      <span class="token keyword">const</span> fetchData <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">$createFetcher</span><span class="token punctuation">(</span>fetch<span class="token punctuation">)</span>
      <span class="token comment">// Send an asynchronous request</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setData'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>At this point we can call <code>action</code> directly in the <code>created</code> hook of the component:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'fetchData'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> vm<span class="token punctuation">:</span> <span class="token keyword">this</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you use the <code>mapActions</code> utility function:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'fetchData'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> vm<span class="token punctuation">:</span> <span class="token keyword">this</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note: We must explicitly pass the current component instance (<code>vm</code>) as <code>payload</code> so that the <code>vm.$createFetcher</code> function can be accessed using the component instance in <code>action</code>.</p> <h2 id="use-apollo"><a href="#use-apollo" aria-hidden="true" class="header-anchor">#</a> Use Apollo</h2> <p><code>Vapper</code> allows you to use <a href="https://vue-apollo.netlify.com/" target="_blank" rel="noopener noreferrer">vue-apollo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and automatically supports <code>SSR</code>.</p> <h3 id="manually-install-dependencies"><a href="#manually-install-dependencies" aria-hidden="true" class="header-anchor">#</a> Manually install dependencies</h3> <p>The following dependencies are required to be installed manually:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>yarn add vue-apollo graphql apollo-client apollo-link apollo-link-http apollo-cache-inmemory graphql-tag
</code></pre></div><p>For more information see: <a href="https://vue-apollo.netlify.com/guide/installation.html#manual-installation" target="_blank" rel="noopener noreferrer">vue-apollo Manual installation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="createapolloclient"><a href="#createapolloclient" aria-hidden="true" class="header-anchor">#</a> createApolloClient</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-client'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpLink <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-link-http'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InMemoryCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-cache-inmemory'</span>
<span class="token keyword">import</span> VueApollo <span class="token keyword">from</span> <span class="token string">'vue-apollo'</span>
<span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">'isomorphic-fetch'</span>

<span class="token comment">// Install the vue plugin</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueApollo<span class="token punctuation">)</span>

<span class="token comment">// Create the apollo client</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createApolloClient</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isServer <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">'server'</span>
  <span class="token keyword">const</span> httpLink <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpLink</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fetch<span class="token punctuation">,</span>
    <span class="token comment">// You should use an absolute URL here</span>
    uri<span class="token punctuation">:</span> <span class="token string">'https://api.graph.cool/simple/v1/cixmkt2ul01q00122mksg82pn'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// If on the client, recover the injected state</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> state <span class="token operator">=</span> window<span class="token punctuation">.</span>__INITIAL_STATE__<span class="token punctuation">.</span>$$apolloState
      <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If you have multiple clients, use `state.&lt;client_id&gt;`</span>
        cache<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>defaultClient<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> apolloClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    link<span class="token punctuation">:</span> httpLink<span class="token punctuation">,</span>
    cache<span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token punctuation">(</span>isServer <span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token comment">// Set this on the server to optimize queries when SSR</span>
      ssrMode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// This will temporary disable query force-fetching</span>
      ssrForceFetchDelay<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> apolloClient
<span class="token punctuation">}</span>
</code></pre></div><h3 id="return-apolloprovider-in-the-entry-file"><a href="#return-apolloprovider-in-the-entry-file" aria-hidden="true" class="header-anchor">#</a> Return <code>apolloProvider</code> in the entry file</h3> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">// Entry file</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueApollo <span class="token keyword">from</span> <span class="token string">'vue-apollo'</span>
<span class="token keyword">import</span> createRouter <span class="token keyword">from</span> <span class="token string">'./createRouter'</span>
<span class="token keyword">import</span> createApolloClient <span class="token keyword">from</span> <span class="token string">'./createApolloClient'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// Export factory function</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createApp</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Create a router instance</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> apolloClient <span class="token operator">=</span> <span class="token function">createApolloClient</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token keyword">const</span> apolloProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueApollo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    defaultClient<span class="token punctuation">:</span> apolloClient<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 2. Create a app instance</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    apolloProvider<span class="token punctuation">,</span>
    router<span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> h <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 3. return</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> apolloProvider <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can see and try to run the example here: <a href="https://github.com/vapperjs/vapper/blob/master/examples/with-vue-apollo/README.md" target="_blank" rel="noopener noreferrer">examples/with-vue-apollo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vapperjs/vapperjs.org/edit/master/docs/data-prefetching.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/entry.html" class="prev">
          Entry file
        </a></span> <span class="next"><a href="/routes-meta.html">
          Routes Meta
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/2.0aa0d321.js" defer></script><script src="/assets/js/15.d774fccf.js" defer></script><script src="/assets/js/app.b7192d51.js" defer></script>
  </body>
</html>
